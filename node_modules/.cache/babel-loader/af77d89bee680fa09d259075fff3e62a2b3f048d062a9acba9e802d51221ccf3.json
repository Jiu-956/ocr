{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"results\"\n};\nconst _hoisted_2 = {\n  class: \"results-container\"\n};\nconst _hoisted_3 = {\n  ref: \"pdfContainer\",\n  class: \"pdf-viewer\"\n};\nconst _hoisted_4 = {\n  class: \"latex-viewer\"\n};\nconst _hoisted_5 = [\"onMouseover\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[3] || (_cache[3] = _createElementVNode(\"h2\", null, \"OCR Results\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_2, [_createCommentVNode(\" 左边 PDF 渲染 \"), _createElementVNode(\"div\", _hoisted_3, null, 512 /* NEED_PATCH */), _createCommentVNode(\" 右边 Nougat LaTeX 输出 \"), _createElementVNode(\"div\", _hoisted_4, [_cache[2] || (_cache[2] = _createElementVNode(\"h3\", null, \"Nougat LaTeX 输出：\", -1 /* CACHED */)), _createElementVNode(\"pre\", null, [_cache[0] || (_cache[0] = _createTextVNode(\"          \")), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.latexLines, (line, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"latex-line\",\n      onMouseover: $event => $setup.scrollPdfTo(index)\n    }, \"\\n            \" + _toDisplayString(line) + \"\\n          \", 41 /* TEXT, PROPS, NEED_HYDRATION */, _hoisted_5);\n  }), 128 /* KEYED_FRAGMENT */)), _cache[1] || (_cache[1] = _createTextVNode(\"\\n        \"))])])])]);\n}","map":{"version":3,"names":["class","ref","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createCommentVNode","_hoisted_3","_hoisted_4","_Fragment","_renderList","$setup","latexLines","line","index","key","onMouseover","$event","scrollPdfTo","_toDisplayString","_hoisted_5"],"sources":["D:\\OCR\\ocr\\src\\views\\Results.vue"],"sourcesContent":["<template>\r\n  <div class=\"results\">\r\n    <h2>OCR Results</h2>\r\n\r\n    <div class=\"results-container\">\r\n      <!-- 左边 PDF 渲染 -->\r\n      <div ref=\"pdfContainer\" class=\"pdf-viewer\"></div>\r\n\r\n      <!-- 右边 Nougat LaTeX 输出 -->\r\n      <div class=\"latex-viewer\">\r\n        <h3>Nougat LaTeX 输出：</h3>\r\n        <pre>\r\n          <div\r\n            v-for=\"(line, index) in latexLines\"\r\n            :key=\"index\"\r\n            class=\"latex-line\"\r\n            @mouseover=\"scrollPdfTo(index)\"\r\n          >\r\n            {{ line }}\r\n          </div>\r\n        </pre>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, computed, onMounted } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport * as pdfjsLib from \"pdfjs-dist\";\r\nimport pdfjsWorker from \"pdfjs-dist/build/pdf.worker.min.js\";\r\n\r\npdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;\r\n\r\n\r\nexport default {\r\n  name: \"OcrResults\",\r\n  setup() {\r\n    const store = useStore();\r\n    const pdfContainer = ref(null);\r\n    const pdfDoc = ref(null);\r\n\r\n    // 计算属性：LaTeX 按行拆分\r\n    const latexLines = computed(() => {\r\n      return store.state.ocrResults?.text\r\n        ? store.state.ocrResults.text.split(\"\\n\")\r\n        : [];\r\n    });\r\n\r\n    // 加载 PDF\r\n    onMounted(async () => {\r\n      const pdfUrl = store.state.ocrResults?.pdfUrl;\r\n      console.log(\"加载 PDF 的 URL:\", pdfUrl); // ✅ 调试用\r\n\r\n      if (pdfUrl) {\r\n        const loadingTask = pdfjsLib.getDocument(pdfUrl);\r\n        pdfDoc.value = await loadingTask.promise;\r\n        console.log(\"PDF 加载成功, 页数:\", pdfDoc.value.numPages);\r\n        renderPage(1); // 默认渲染第 1 页\r\n      } else {\r\n        console.error(\"pdfUrl 无效，无法加载 PDF\");\r\n      }\r\n    });\r\n\r\n    const renderPage = async (num) => {\r\n      if (!pdfDoc.value) return;\r\n      const page = await pdfDoc.value.getPage(num);\r\n      const viewport = page.getViewport({ scale: 1.5 });\r\n\r\n      const canvas = document.createElement(\"canvas\");\r\n      const context = canvas.getContext(\"2d\");\r\n      canvas.height = viewport.height;\r\n      canvas.width = viewport.width;\r\n\r\n      const renderContext = { canvasContext: context, viewport };\r\n      await page.render(renderContext).promise;\r\n\r\n      pdfContainer.value.innerHTML = \"\"; // 清空旧的\r\n      pdfContainer.value.appendChild(canvas);\r\n    };\r\n\r\n    // 鼠标悬停时滚动 PDF 对应位置\r\n    const scrollPdfTo = (lineIndex) => {\r\n      if (pdfContainer.value && store.state.ocrResults?.text) {\r\n        const totalLines = store.state.ocrResults.text.split(\"\\n\").length;\r\n        const percent = lineIndex / totalLines;\r\n        pdfContainer.value.scrollTop =\r\n          pdfContainer.value.scrollHeight * percent;\r\n      }\r\n    };\r\n\r\n    return {\r\n      pdfContainer,\r\n      latexLines,\r\n      scrollPdfTo,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.results-container {\r\n  display: flex;\r\n  gap: 20px;\r\n}\r\n\r\n.pdf-viewer {\r\n  flex: 1;\r\n  height: 80vh;\r\n  overflow-y: auto;\r\n  border: 1px solid #ddd;\r\n  background: #f9f9f9;\r\n}\r\n\r\n.latex-viewer {\r\n  flex: 1;\r\n  height: 80vh;\r\n  overflow-y: auto;\r\n  border: 1px solid #ddd;\r\n  padding: 10px;\r\n  font-family: monospace;\r\n  background: #fff;\r\n}\r\n\r\n.latex-line {\r\n  padding: 2px 5px;\r\n  cursor: pointer;\r\n}\r\n\r\n.latex-line:hover {\r\n  background: #e0f7fa;\r\n}\r\n</style>\r\n"],"mappings":";;EACOA,KAAK,EAAC;AAAS;;EAGbA,KAAK,EAAC;AAAmB;;EAEvBC,GAAG,EAAC,cAAc;EAACD,KAAK,EAAC;;;EAGzBA,KAAK,EAAC;AAAc;;;uBAR7BE,mBAAA,CAsBM,OAtBNC,UAsBM,G,0BArBJC,mBAAA,CAAoB,YAAhB,aAAW,qBAEfA,mBAAA,CAkBM,OAlBNC,UAkBM,GAjBJC,mBAAA,eAAkB,EAClBF,mBAAA,CAAiD,OAAjDG,UAAiD,+BAEjDD,mBAAA,wBAA2B,EAC3BF,mBAAA,CAYM,OAZNI,UAYM,G,0BAXJJ,mBAAA,CAAyB,YAArB,kBAAgB,qBACpBA,mBAAA,CASM,c,2CATD,YACH,K,kBAAAF,mBAAA,CAOMO,SAAA,QAAAC,WAAA,CANoBC,MAAA,CAAAC,UAAU,GAA1BC,IAAI,EAAEC,KAAK;yBADrBZ,mBAAA,CAOM;MALHa,GAAG,EAAED,KAAK;MACXd,KAAK,EAAC,YAAY;MACjBgB,WAAS,EAAAC,MAAA,IAAEN,MAAA,CAAAO,WAAW,CAACJ,KAAK;OAC9B,gBACC,GAAAK,gBAAA,CAAGN,IAAI,IAAG,cACZ,wCAAAO,UAAA;6EAAM,YACR,G","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}