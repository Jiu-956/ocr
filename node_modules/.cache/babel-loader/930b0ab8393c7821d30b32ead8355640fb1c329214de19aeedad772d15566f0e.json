{"ast":null,"code":"import { createStore } from 'vuex';\nimport api from './services/api';\nexport default createStore({\n  state: {\n    uploadStatus: '',\n    // uploading / success / failed\n    ocrResults: null,\n    // { text: string, ... }\n    error: null,\n    uploadedFileUrl: null // ObjectURL，用于 pdf 预览\n  },\n  mutations: {\n    setUploadStatus(state, status) {\n      state.uploadStatus = status;\n    },\n    setOcrResults(state, results) {\n      state.ocrResults = results;\n    },\n    setError(state, error) {\n      state.error = error;\n    },\n    setUploadedFileUrl(state, url) {\n      state.uploadedFileUrl = url;\n    },\n    resetState(state) {\n      // 释放旧的 ObjectURL\n      if (state.uploadedFileUrl) {\n        try {\n          URL.revokeObjectURL(state.uploadedFileUrl);\n        } catch {}\n      }\n      state.uploadStatus = '';\n      state.ocrResults = null;\n      state.error = null;\n      state.uploadedFileUrl = null;\n      // 清理 sessionStorage 兜底\n      sessionStorage.removeItem('uploadedFileUrl');\n    }\n  },\n  actions: {\n    // 这里参数直接是 File 对象\n    async uploadFile({\n      commit\n    }, file) {\n      commit('resetState');\n      commit('setUploadStatus', 'uploading');\n      try {\n        // 先存 URL，保证结果页能拿到 PDF\n        const url = URL.createObjectURL(file);\n        commit('setUploadedFileUrl', url);\n        sessionStorage.setItem('uploadedFileUrl', url);\n\n        // 调用后端（services/api.js 会封装成 FormData）\n        const response = await api.uploadFile(file);\n\n        // 兼容字符串 / JSON\n        let data = response?.data;\n        if (typeof data === 'string') {\n          try {\n            data = JSON.parse(data);\n          } catch {/* 就是纯文本 */}\n        }\n\n        // 统一写入 ocrResults\n        const text = data && (data.text || data.content) || (typeof data === 'string' ? data : '');\n        commit('setOcrResults', {\n          text\n        });\n        commit('setUploadStatus', 'success');\n      } catch (error) {\n        console.error('Upload failed:', error);\n        let errMsg = 'An error occurred!';\n        if (error.response?.data) {\n          errMsg = typeof error.response.data === 'string' ? error.response.data : error.response.data.message || errMsg;\n        } else if (error.message) {\n          errMsg = error.message;\n        }\n        commit('setError', errMsg);\n        commit('setUploadStatus', 'failed');\n      }\n    }\n  }\n});","map":{"version":3,"names":["createStore","api","state","uploadStatus","ocrResults","error","uploadedFileUrl","mutations","setUploadStatus","status","setOcrResults","results","setError","setUploadedFileUrl","url","resetState","URL","revokeObjectURL","sessionStorage","removeItem","actions","uploadFile","commit","file","createObjectURL","setItem","response","data","JSON","parse","text","content","console","errMsg","message"],"sources":["D:/OCR/ocr/src/store.js"],"sourcesContent":["import { createStore } from 'vuex'\r\nimport api from './services/api'\r\n\r\nexport default createStore({\r\n  state: {\r\n    uploadStatus: '',              // uploading / success / failed\r\n    ocrResults: null,              // { text: string, ... }\r\n    error: null,\r\n    uploadedFileUrl: null          // ObjectURL，用于 pdf 预览\r\n  },\r\n  mutations: {\r\n    setUploadStatus(state, status) {\r\n      state.uploadStatus = status\r\n    },\r\n    setOcrResults(state, results) {\r\n      state.ocrResults = results\r\n    },\r\n    setError(state, error) {\r\n      state.error = error\r\n    },\r\n    setUploadedFileUrl(state, url) {\r\n      state.uploadedFileUrl = url\r\n    },\r\n    resetState(state) {\r\n      // 释放旧的 ObjectURL\r\n      if (state.uploadedFileUrl) {\r\n        try { URL.revokeObjectURL(state.uploadedFileUrl) } catch {}\r\n      }\r\n      state.uploadStatus = ''\r\n      state.ocrResults = null\r\n      state.error = null\r\n      state.uploadedFileUrl = null\r\n      // 清理 sessionStorage 兜底\r\n      sessionStorage.removeItem('uploadedFileUrl')\r\n    }\r\n  },\r\n  actions: {\r\n    // 这里参数直接是 File 对象\r\n    async uploadFile({ commit }, file) {\r\n      commit('resetState')\r\n      commit('setUploadStatus', 'uploading')\r\n\r\n      try {\r\n        // 先存 URL，保证结果页能拿到 PDF\r\n        const url = URL.createObjectURL(file)\r\n        commit('setUploadedFileUrl', url)\r\n        sessionStorage.setItem('uploadedFileUrl', url)\r\n\r\n        // 调用后端（services/api.js 会封装成 FormData）\r\n        const response = await api.uploadFile(file)\r\n\r\n        // 兼容字符串 / JSON\r\n        let data = response?.data\r\n        if (typeof data === 'string') {\r\n          try { data = JSON.parse(data) } catch { /* 就是纯文本 */ }\r\n        }\r\n\r\n        // 统一写入 ocrResults\r\n        const text = (data && (data.text || data.content)) || (typeof data === 'string' ? data : '')\r\n        commit('setOcrResults', { text })\r\n\r\n        commit('setUploadStatus', 'success')\r\n      } catch (error) {\r\n        console.error('Upload failed:', error)\r\n        let errMsg = 'An error occurred!'\r\n        if (error.response?.data) {\r\n          errMsg = typeof error.response.data === 'string'\r\n            ? error.response.data\r\n            : (error.response.data.message || errMsg)\r\n        } else if (error.message) {\r\n          errMsg = error.message\r\n        }\r\n        commit('setError', errMsg)\r\n        commit('setUploadStatus', 'failed')\r\n      }\r\n    }\r\n  }\r\n})\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}