{"ast":null,"code":"import { createElementVNode as _createElementVNode, withModifiers as _withModifiers, normalizeClass as _normalizeClass, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"file-upload\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"selected-file\"\n};\nconst _hoisted_3 = {\n  class: \"file-preview\"\n};\nconst _hoisted_4 = {\n  class: \"file-details\"\n};\nconst _hoisted_5 = {\n  class: \"file-name\"\n};\nconst _hoisted_6 = {\n  class: \"file-size\"\n};\nconst _hoisted_7 = [\"disabled\"];\nconst _hoisted_8 = {\n  key: 0,\n  class: \"loading-spinner\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"form\", {\n    onSubmit: _cache[5] || (_cache[5] = _withModifiers((...args) => $options.handleSubmit && $options.handleSubmit(...args), [\"prevent\"])),\n    class: \"upload-form\"\n  }, [_createElementVNode(\"div\", {\n    class: _normalizeClass([\"upload-area\", {\n      'drag-over': $data.isDragOver\n    }]),\n    onDragover: _cache[1] || (_cache[1] = _withModifiers((...args) => $options.handleDragOver && $options.handleDragOver(...args), [\"prevent\"])),\n    onDragleave: _cache[2] || (_cache[2] = (...args) => $options.handleDragLeave && $options.handleDragLeave(...args)),\n    onDrop: _cache[3] || (_cache[3] = _withModifiers((...args) => $options.handleDrop && $options.handleDrop(...args), [\"prevent\"]))\n  }, [_cache[6] || (_cache[6] = _createElementVNode(\"div\", {\n    class: \"upload-icon\"\n  }, \"📁\", -1 /* CACHED */)), _cache[7] || (_cache[7] = _createElementVNode(\"h3\", null, \"拖拽文件到此处或点击选择\", -1 /* CACHED */)), _cache[8] || (_cache[8] = _createElementVNode(\"p\", null, \"支持 JPG、PNG、PDF 格式\", -1 /* CACHED */)), _createElementVNode(\"input\", {\n    type: \"file\",\n    id: \"file\",\n    ref: \"fileInput\",\n    onChange: _cache[0] || (_cache[0] = (...args) => $options.handleFileChange && $options.handleFileChange(...args)),\n    accept: \"image/*,.pdf\",\n    required: \"\",\n    class: \"file-input\"\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), _cache[9] || (_cache[9] = _createElementVNode(\"label\", {\n    for: \"file\",\n    class: \"file-label\"\n  }, \" 选择文件 \", -1 /* CACHED */))], 34 /* CLASS, NEED_HYDRATION */), $data.selectedFile ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_cache[10] || (_cache[10] = _createElementVNode(\"span\", {\n    class: \"file-icon\"\n  }, \"📄\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"span\", _hoisted_5, _toDisplayString($data.selectedFile.name), 1 /* TEXT */), _createElementVNode(\"span\", _hoisted_6, _toDisplayString($options.formatFileSize($data.selectedFile.size)), 1 /* TEXT */)]), _createElementVNode(\"button\", {\n    type: \"button\",\n    onClick: _cache[4] || (_cache[4] = (...args) => $options.clearFile && $options.clearFile(...args)),\n    class: \"clear-btn\"\n  }, \"×\")])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"button\", {\n    type: \"submit\",\n    disabled: $options.isUploading || !$data.selectedFile,\n    class: \"submit-btn\"\n  }, [$options.isUploading ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, \"⏳\")) : _createCommentVNode(\"v-if\", true), _createTextVNode(\" \" + _toDisplayString($options.isUploading ? '处理中...' : '开始识别'), 1 /* TEXT */)], 8 /* PROPS */, _hoisted_7), _ctx.uploadStatus ? (_openBlock(), _createElementBlock(\"div\", {\n    key: 1,\n    class: _normalizeClass([\"status-message\", $options.statusClass])\n  }, _toDisplayString($options.statusMessage), 3 /* TEXT, CLASS */)) : _createCommentVNode(\"v-if\", true)], 32 /* NEED_HYDRATION */)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","onSubmit","_cache","_withModifiers","args","$options","handleSubmit","_normalizeClass","$data","isDragOver","onDragover","handleDragOver","onDragleave","handleDragLeave","onDrop","handleDrop","type","id","ref","onChange","handleFileChange","accept","required","for","selectedFile","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","name","_hoisted_6","formatFileSize","size","onClick","clearFile","disabled","isUploading","_hoisted_8","_ctx","uploadStatus","statusClass","statusMessage"],"sources":["D:\\OCR\\ocr\\src\\components\\FileUpload.vue"],"sourcesContent":["<template>\r\n  <div class=\"file-upload\">\r\n    <form @submit.prevent=\"handleSubmit\" class=\"upload-form\">\r\n      <div class=\"upload-area\" :class=\"{ 'drag-over': isDragOver }\" \r\n           @dragover.prevent=\"handleDragOver\" \r\n           @dragleave=\"handleDragLeave\" \r\n           @drop.prevent=\"handleDrop\">\r\n        <div class=\"upload-icon\">📁</div>\r\n        <h3>拖拽文件到此处或点击选择</h3>\r\n        <p>支持 JPG、PNG、PDF 格式</p>\r\n        <input \r\n          type=\"file\" \r\n          id=\"file\" \r\n          ref=\"fileInput\" \r\n          @change=\"handleFileChange\" \r\n          accept=\"image/*,.pdf\"\r\n          required\r\n          class=\"file-input\"\r\n        >\r\n        <label for=\"file\" class=\"file-label\">\r\n          选择文件\r\n        </label>\r\n      </div>\r\n      \r\n      <div v-if=\"selectedFile\" class=\"selected-file\">\r\n        <div class=\"file-preview\">\r\n          <span class=\"file-icon\">📄</span>\r\n          <div class=\"file-details\">\r\n            <span class=\"file-name\">{{ selectedFile.name }}</span>\r\n            <span class=\"file-size\">{{ formatFileSize(selectedFile.size) }}</span>\r\n          </div>\r\n          <button type=\"button\" @click=\"clearFile\" class=\"clear-btn\">×</button>\r\n        </div>\r\n      </div>\r\n      \r\n      <button type=\"submit\" :disabled=\"isUploading || !selectedFile\" class=\"submit-btn\">\r\n        <span v-if=\"isUploading\" class=\"loading-spinner\">⏳</span>\r\n        {{ isUploading ? '处理中...' : '开始识别' }}\r\n      </button>\r\n      \r\n      <div v-if=\"uploadStatus\" class=\"status-message\" :class=\"statusClass\">\r\n        {{ statusMessage }}\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapState, mapActions } from 'vuex'\r\n\r\nexport default {\r\n  name: 'FileUpload',\r\n  data() {\r\n    return {\r\n      selectedFile: null,\r\n      isDragOver: false\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState(['uploadStatus', 'error']),\r\n    isUploading() {\r\n      return this.uploadStatus === 'uploading'\r\n    },\r\n    statusMessage() {\r\n      if (this.uploadStatus === 'uploading') return '正在处理您的文件...'\r\n      if (this.uploadStatus === 'success') return '文件处理成功！'\r\n      if (this.error) return this.error\r\n      return ''\r\n    },\r\n    statusClass() {\r\n      return {\r\n        'status-success': this.uploadStatus === 'success',\r\n        'status-error': this.error\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions(['uploadFile']),  // ✅ Vuex action\r\n\r\n    handleFileChange(event) {\r\n      const file = event.target.files[0]\r\n      if (file) {\r\n        this.selectedFile = file\r\n      }\r\n      this.$store.commit('resetState')\r\n    },\r\n    handleDragOver(event) {\r\n      event.preventDefault()\r\n      this.isDragOver = true\r\n    },\r\n    handleDragLeave() {\r\n      this.isDragOver = false\r\n    },\r\n    handleDrop(event) {\r\n      event.preventDefault()\r\n      this.isDragOver = false\r\n      const files = event.dataTransfer.files\r\n      if (files.length > 0) {\r\n        this.selectedFile = files[0]\r\n        this.$refs.fileInput.files = files\r\n        this.$store.commit('resetState')\r\n      }\r\n    },\r\n    clearFile() {\r\n      this.selectedFile = null\r\n      this.$refs.fileInput.value = ''\r\n      this.$store.commit('resetState')\r\n    },\r\n    formatFileSize(bytes) {\r\n      if (bytes === 0) return '0 Bytes'\r\n      const k = 1024\r\n      const sizes = ['Bytes', 'KB', 'MB', 'GB']\r\n      const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\r\n    },\r\n\r\n    // ✅ 修改过的 handleSubmit\r\n    async handleSubmit() {\r\n      if (!this.selectedFile) return\r\n\r\n      try {\r\n        // 生成本地 PDF Blob URL\r\n        const pdfBlobUrl = URL.createObjectURL(this.selectedFile)\r\n\r\n        // 调用 OCR 接口（Vuex action）\r\n        const ocrText = await this.uploadFile(this.selectedFile)\r\n\r\n        // 存到 Vuex（带上 pdfUrl）\r\n        this.$store.commit('setOcrResults', {\r\n          pdfUrl: pdfBlobUrl,\r\n          text: ocrText || ''\r\n        })\r\n\r\n        // 成功后跳转\r\n        if (this.uploadStatus === 'success') {\r\n          this.$router.push('/results')\r\n        }\r\n      } catch (err) {\r\n        console.error('上传失败:', err)\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.file-upload {\r\n  width: 100%;\r\n}\r\n\r\n.upload-form {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 1.5rem;\r\n}\r\n\r\n.upload-area {\r\n  border: 2px dashed #d1d5db;\r\n  border-radius: 12px;\r\n  padding: 3rem 2rem;\r\n  text-align: center;\r\n  transition: all 0.3s ease;\r\n  background: #fafbfc;\r\n  position: relative;\r\n  cursor: pointer;\r\n}\r\n\r\n.upload-area:hover {\r\n  border-color: #667eea;\r\n  background: #f0f4ff;\r\n}\r\n\r\n.upload-area.drag-over {\r\n  border-color: #667eea;\r\n  background: #e0e7ff;\r\n  transform: scale(1.02);\r\n}\r\n\r\n.upload-icon {\r\n  font-size: 3rem;\r\n  margin-bottom: 1rem;\r\n  opacity: 0.7;\r\n}\r\n\r\n.upload-area h3 {\r\n  color: #374151;\r\n  margin-bottom: 0.5rem;\r\n  font-size: 1.2rem;\r\n}\r\n\r\n.upload-area p {\r\n  color: #6b7280;\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.file-input {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  opacity: 0;\r\n  cursor: pointer;\r\n}\r\n\r\n.file-label {\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  color: white;\r\n  padding: 0.8rem 2rem;\r\n  border-radius: 8px;\r\n  cursor: pointer;\r\n  font-weight: 500;\r\n  transition: all 0.3s ease;\r\n  display: inline-block;\r\n}\r\n\r\n.file-label:hover {\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\r\n}\r\n\r\n.selected-file {\r\n  background: white;\r\n  border: 1px solid #e5e7eb;\r\n  border-radius: 8px;\r\n  padding: 1rem;\r\n}\r\n\r\n.file-preview {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 1rem;\r\n}\r\n\r\n.file-icon {\r\n  font-size: 2rem;\r\n}\r\n\r\n.file-details {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n}\r\n\r\n.file-name {\r\n  font-weight: 600;\r\n  color: #374151;\r\n  margin-bottom: 0.25rem;\r\n}\r\n\r\n.file-size {\r\n  font-size: 0.8rem;\r\n  color: #6b7280;\r\n}\r\n\r\n.clear-btn {\r\n  background: #ef4444;\r\n  color: white;\r\n  border: none;\r\n  width: 30px;\r\n  height: 30px;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  font-size: 1.2rem;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.clear-btn:hover {\r\n  background: #dc2626;\r\n  transform: scale(1.1);\r\n}\r\n\r\n.submit-btn {\r\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\r\n  color: white;\r\n  border: none;\r\n  padding: 1rem 2rem;\r\n  border-radius: 8px;\r\n  cursor: pointer;\r\n  font-size: 1.1rem;\r\n  font-weight: 600;\r\n  transition: all 0.3s ease;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.submit-btn:hover:not(:disabled) {\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);\r\n}\r\n\r\n.submit-btn:disabled {\r\n  background: #9ca3af;\r\n  cursor: not-allowed;\r\n  transform: none;\r\n}\r\n\r\n.loading-spinner {\r\n  animation: spin 1s linear infinite;\r\n}\r\n\r\n@keyframes spin {\r\n  from { transform: rotate(0deg); }\r\n  to { transform: rotate(360deg); }\r\n}\r\n\r\n.status-message {\r\n  padding: 1rem;\r\n  border-radius: 8px;\r\n  text-align: center;\r\n  font-weight: 500;\r\n}\r\n\r\n.status-success {\r\n  background: #d1fae5;\r\n  color: #065f46;\r\n  border: 1px solid #a7f3d0;\r\n}\r\n\r\n.status-error {\r\n  background: #fee2e2;\r\n  color: #991b1b;\r\n  border: 1px solid #fecaca;\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 768px) {\r\n  .upload-area {\r\n    padding: 2rem 1rem;\r\n  }\r\n  \r\n  .file-preview {\r\n    flex-direction: column;\r\n    text-align: center;\r\n  }\r\n  \r\n  .file-details {\r\n    align-items: center;\r\n  }\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}